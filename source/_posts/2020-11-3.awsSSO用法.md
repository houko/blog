---
author: 小莫
date: 2020-11-01
title: AWS SSO用法
tags:
- sso
category: aws
permalink: awsSSo
---

aws sso ( AWS Single Sign-On) 中文名叫做aws单点登陆，如果您的组织使用 AWS Single Sign-On (AWS SSO)，则您的用户可以登录到 Active Directory 或内置的 AWS SSO 目录，或[其他连接到 AWS SSO 的 iDP](https://docs.aws.amazon.com/singlesignon/latest/userguide/manage-your-identity-source-idp.html)，并映射到使您能够运行 AWS CLI 命令的 AWS Identity and Access Management (IAM) 角色。无论您使用哪个 IdP，AWS SSO 都会将些区别抽象出来，并且它们都与下面所述的 AWS CLI 一起工作。

<!-- more -->

# 背景

在企业发展初期，企业使用的系统很少，通常一个或者两个，每个系统都有自己的登录模块，运营人员每天用自己的账号登录，很方便。

但随着企业的发展，用到的系统随之增多，运营人员在操作不同的系统时，需要多次登录，而且每个系统的账号都不一样，这对于运营人员来说，很不方便。于是，就想到是不是可以在一个系统登录，其他系统就不用登录了呢？这就是单点登录要解决的问题。

单点登录英文全称Single Sign On，简称就是SSO。它的解释是：**在多个应用系统中，只需要登录一次，就可以访问其他相互信任的应用系统。**



![12540413-ddff3256817e357b](https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp)

如图所示，图中有3个系统，分别是Application1、Application2、和SSO。Application1、Application2没有登录模块，而SSO只有登录模块，没有其他的业务模块，当Application1、Application2需要登录时，将跳到SSO系统，SSO系统完成登录，其他的应用系统也就随之登录了。这完全符合我们对单点登录（SSO）的定义。

# 技术实现

在说单点登录（SSO）的技术实现之前，我们先说一说普通的登录认证机制。

![12540413-ddff3256817e357b](https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp)

如上图所示，我们在浏览器（Browser）中访问一个应用，这个应用需要登录，我们填写完用户名和密码后，完成登录认证。这时，我们在这个用户的session中标记登录状态为yes（已登录），同时在浏览器（Browser）中写入Cookie，这个Cookie是这个用户的唯一标识。下次我们再访问这个应用的时候，请求中会带上这个Cookie，服务端会根据这个Cookie找到对应的session，通过session来判断这个用户是否登录。如果不做特殊配置，这个Cookie的名字叫做jsessionid，值在服务端（server）是唯一的。

## 同域下的单点登录

一个企业一般情况下只有一个域名，通过二级域名区分不同的系统。比如我们有个域名叫做：a.com，同时有两个业务系统分别为：app1.a.com和app2.a.com。我们要做单点登录（SSO），需要一个登录系统，叫做：sso.a.com。

我们只要在sso.a.com登录，app1.a.com和app2.a.com就也登录了。通过上面的登陆认证机制，我们可以知道，在sso.a.com中登录了，其实是在sso.a.com的服务端的session中记录了登录状态，同时在浏览器端（Browser）的sso.a.com下写入了Cookie。那么我们怎么才能让app1.a.com和app2.a.com登录呢？这里有两个问题：

-   Cookie是不能跨域的，我们Cookie的domain属性是sso.a.com，在给app1.a.com和app2.a.com发送请求是带不上的。
-   sso、app1和app2是不同的应用，它们的session存在自己的应用内，是不共享的。

![12540413-ddff3256817e357b](https://image.xiaomo.info//blog/12540413-ddff3256817e357b.webp)image

那么我们如何解决这两个问题呢？针对第一个问题，sso登录以后，可以将Cookie的域设置为顶域，即.a.com，这样所有子域的系统都可以访问到顶域的Cookie。**我们在设置Cookie时，只能设置顶域和自己的域，不能设置其他的域。比如：我们不能在自己的系统中给baidu.com的域设置Cookie。**

Cookie的问题解决了，我们再来看看session的问题。我们在sso系统登录了，这时再访问app1，Cookie也带到了app1的服务端（Server），app1的服务端怎么找到这个Cookie对应的Session呢？这里就要把3个系统的Session共享，如图所示。共享Session的解决方案有很多，例如：Spring-Session。这样第2个问题也解决了。



[sso文档](https://docs.aws.amazon.com/zh_cn/cli/latest/userguide/cli-configure-sso.html)



